# Web Viewer Extension 使用说明

## 新功能
现在插件支持加载网页和本地文件，并具有状态记忆功能！

## 使用方法

### 方法1：文件选择按钮（推荐）
1. 点击紫色的📁按钮
2. 在弹出的文件选择对话框中选择PDF或HTML文件
3. 如果之前保存过该文件的进度，会自动跳转到保存的页码
4. 点击💾按钮保存当前阅读进度（会弹出对话框让你输入当前页码）
5. 文件会在侧边栏中直接显示
6. 下次打开同一文件会自动恢复到保存的进度

### 方法2：直接输入网址
1. 在输入框中输入网址，例如：
   - `https://weread.qq.com/web/reader/...`
   - `http://example.com`
2. 按回车键或等待1秒自动加载
3. 下次打开插件会自动恢复上次的网页

### 方法3：快捷键操作
- 按 `Ctrl+Shift+S` 快速打开/关闭插件（Mac: `Command+Shift+S`）

## 支持的文件格式
- PDF文件 (.pdf) - 通过文件选择上传
- HTML文件 (.html, .htm) - 直接在侧边栏显示
- 文本文件 (.txt) - 直接在侧边栏显示
- 网页 (http/https) - 直接在侧边栏显示

## 新特性
### 🔄 状态记忆功能
- 插件会自动记住上次打开的网页或文件名
- 重新打开插件时显示上次使用的文件名
- 支持网页URL和文件进度的记忆
- 需要重新选择文件来继续阅读（避免存储配额问题）

### ⚡ 简化操作
- 移除了"加载"和"刷新"按钮，操作更简洁
- 输入网址后按回车键或等待1秒自动加载
- 支持快捷键快速打开/关闭插件

### 🎯 智能加载
- 检测到完整URL时自动加载
- 文件选择后立即显示
- 优化的用户体验

### 💾 进度保存功能
- 点击💾按钮弹出对话框，输入当前阅读的页码
- 系统会尝试自动检测页码作为默认值
- 按文件名独立保存每个文件的进度
- 重新选择同一文件时自动恢复到保存的页码
- 进度数据永久保存在本地存储中
- 支持多个文件的进度管理
- 确保页码输入的准确性

## 技术改进
- ✅ 自动识别本地文件路径格式
- ✅ 支持Windows、Linux、Mac路径格式
- ✅ 添加了file://协议支持
- ✅ 优化了URL处理逻辑和URL编码支持
- ✅ 修复了URL输入框显示被截断的问题
- ✅ 添加了专门的PDF文件处理界面
- ✅ 支持URL编码的中文文件名

## 已解决的问题
1. ✅ URL显示被截断 - 优化了CSS样式
2. ✅ Chrome屏蔽blob URL - 改用文件上传方式
3. ✅ 中文文件名乱码 - 文件选择自动处理
4. ✅ 安全限制问题 - 简化为文件上传模式
5. ✅ 重复按钮问题 - 移除了重复的界面元素
6. ✅ PDF嵌入高度问题 - 修改为100%高度，铺满侧边栏
7. ✅ 刷新后双层界面 - 修复了容器重置逻辑
8. ✅ 复杂的路径处理 - 简化为文件选择上传
9. ✅ 状态丢失问题 - 添加了完整的状态记忆功能
10. ✅ 操作复杂问题 - 精简了界面和操作流程
11. ✅ 快捷键支持 - 添加了Ctrl+Shift+S快捷键
12. ✅ 文件数据丢失 - 改为只保存文件名和进度信息
13. ✅ 页码控制需求 - 添加了智能页码检测和跳转功能
14. ✅ 进度保存需求 - 添加了自动进度保存和恢复功能
15. ✅ 页码输入错误 - 移除手动输入，改为自动检测
16. ✅ 存储配额超限 - 不再保存完整文件数据，避免配额问题

## 测试建议
1. **文件上传测试** - 使用📁按钮选择PDF文件，测试显示效果
2. **自动进度恢复测试** - 重新选择同一文件，检查是否自动跳转到保存的页码
3. **智能进度保存测试** - 浏览PDF后点击💾按钮，验证自动检测页码功能
4. **多文件进度测试** - 测试不同文件的进度是否独立保存
5. **状态记忆测试** - 关闭插件后重新打开，检查文件和页码是否恢复
6. **快捷键测试** - 使用Ctrl+Shift+S测试快捷键功能
7. **错误处理测试** - 测试没有文件时点击保存按钮的错误提示
